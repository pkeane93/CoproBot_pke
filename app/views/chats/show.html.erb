<%= turbo_stream_from @chat %>

<div class="flex h-[calc(100vh-4rem)] bg-base-200">
  <%# Left sidebar with chat history %>
  <div class="w-1/3 border-r border-base-300 overflow-y-auto p-4 bg-base-100">

    <%# New chat button %>
    <div class="sticky top-0 bg-base-100 pb-4 z-10">
      <%= link_to "+ New Chat", 
        section_chats_path(@section), 
        data: { turbo_method: :post },
        class: "btn btn-ghost btn-outline w-full mb-4" %>
    </div>



    <%# Iterating through all the chats including the newly created one %>
    <% if @chats.any? %>
      <% @chats.each do |chat| %>

      <%# Checking if it is the last chat to have been added to create a different layout %>
        <div class="card bg-base-100 mb-3 shadow-sm hover:shadow-md transition">
          <div class="card-body">
            <h2 class="card-title text-lg font-semibold" id="chat-title"><%= chat.title %></h2>
            <div class="card-actions justify-end">
              <% if chat == @chat %>
                <%= link_to "Current chat", "#", class: "btn btn-soft btn-primary w-35 cursor-default pointer-events-none" %>
              <% else %>
                <%= link_to "Talk to this chat", chat_path(chat), class: "btn btn-soft w-35" %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <%# Right sidebar with the chat to text to %>
  <div class="flex flex-col w-2/3 h-full">
    <%# title on the right side %>
    <div class="flex-shrink-0 flex items-center justify-between p-6 border-b border-base-300 bg-base-100">
      <h1 class="text-2xl font-bold">Your <%= @section.name %> Assistant </h1>
        <%= link_to sections_path, class: "btn btn-sm btn-outline" do %>
          ‚Üê Back to sections
         <% end %>
    </div>

    <%# visualizing the messages depending on their role %>
    <div id="messages" class="flex-1 overflow-y-auto p-6 space-y-4">
      <%= render "messages/messages", messages: @chat.messages %>   
    </div>

    <%# offering forms to ask new messages to the AI %>
    <div id="new_message_container" class="border-t border-base-300 bg-base-100 p-4">
      <%# chat_messages_path(@chat) OLD PATH %>
        <%= render "messages/form", chat: @chat, message: @message %>
    </div>
  </div>
</div>