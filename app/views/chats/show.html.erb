<div class="w-[1200px] container mx-auto">


  <h1 class="text-5xl font-bold">Your <%= @section.name %> assistant </h1>

  <div class="flex">
    <div class="w-2/3 flex flex-col">

      <%# Iterating through all the chats including the newly created one %>
      <% if @chats.any? %>
        <% @chats.each do |chat| %>

        <%# Checking if it is the last chat to have been added to create a different layout %>
          <% if chat.id == @chats.first.id %>
            <div class="card card-border bg-base-100 w-100">
              <div class="card-body">
                <h2 class="card-title"><%= chat.title %></h2>
              </div>
            </div>

          <%# Adding standard layout to all the other historic chats %>
          <% else %>
            <div class="card card-border bg-base-100 w-100">
              <div class="card-body">
                <h2 class="card-title"><%= chat.title %></h2>
                <div class="card-actions justify-end">
                  <%= link_to "Talk to this chat", chat_path(chat), class: "btn btn-primary" %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>

    </div>

    <div class="w-1/3">
      <%# visualizing the messages depending on their role %>
       <div id="messages">
        <% @chat.messages.each do |message| %>
          <% if message.role == "assistant" %>
            <div class="flex justify-start mb-2">
              <div class="bg-white text-grey-800 px-4 py-2 rounded-2xl shadow-sm max-w-[70%]">
                <%= raw(render_markdown(message.content)) %>
              </div>
            </div>
          <% elsif message.role == "user" %>
            <div class="flex justify-end mb-5">
              <div class="bg-blue-100 text-grey-900 px-4 py-2 rounded-2xl shadow-sm max-w-[70%]">
                <%= raw(render_markdown(message.content)) %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>

      <%# offering forms to ask new messages to the AI %>
      <div id="new_message_container">
        <%# chat_messages_path(@chat) OLD PATH %>
        <%= form_with scope: "ai_messages", url: chat_messages_path(@chat), method: :post do |myform| %>
          <div>
            <%= myform.label :content, "Ask your question:" %>
            <%= myform.text_field :content %>
          </div>
          <%= myform.submit "Ask question", class: "btn btn-primary" %>
        <% end %>
      </div>
    </div>
  </div>
</div>